
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mapa Interactivo Ecoaldea Tanaj</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="css/estilo.css" />
</head>
<body>
<header>
  <h1>Mapa Interactivo de Ecoaldea Tanaj</h1>
</header>
<div id="map"></div>

<div id="legend" class="legend">
  <h4>LEYENDA</h4>
  <details>
    <summary><strong>Atractivos</strong></summary>
    <ul>
      <li><img src="iconos/punto_5.png" width="20"> Atrativos</li>
      <li><img src="iconos/punto_2.png" width="20"> Zonas Arqueológicas</li>
    </ul>
  </details>
  <details>
    <summary><strong>Ecoaldea</strong></summary>
    <ul>
      <li><img src="iconos/punto_3.png" width="20"> Ecoaldea</li>
    </ul>
  </details>
  <details>
    <summary><strong>Servicios</strong></summary>
    <ul>
      <li><img src="iconos/punto_4.png" width="20"> Servicios</li>
    </ul>
  </details>
  <details>
    <summary><strong>Transporte</strong></summary>
    <ul>
      <li><img src="iconos/punto_1.png" width="20"> Transporte</li>
    </ul>
  </details>
  <details>
    <summary><strong>Líneas</strong></summary>
    <ul>
      <li><span style="display:inline-block;width:20px;height:4px;background:#d95f02;"></span> Camino a la Zona Arqueolóica de Calakmul</li>
      <li><span style="display:inline-block;width:20px;height:4px;background:#7570b3;"></span> Carretera Champotón-Escárcega</li>
      <li><span style="display:inline-block;width:20px;height:4px;background:#1b9e77;"></span> Carretera Escárcega-Chetumal</li>
      <li><span style="display:inline-block;width:20px;height:4px;background:#e7298a;"></span> Trazo Tren Maya</li>
    </ul>
  </details>
</div>

<button class="pulse-btn" title="Mostrar mi ubicación">📍</button>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.4.1/papaparse.min.js"></script>
<script>
  const map = L.map('map').setView([18.51, -89.88], 13);
  L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '© CartoDB, OpenStreetMap contributors'
  }).addTo(map);

  const capas = {};

  // Íconos por tipo
  const iconos = {
    "Servicios": L.icon({ iconUrl: 'iconos/punto_4.png', iconSize: [30,30], iconAnchor: [15,30] }),
    "Transporte": L.icon({ iconUrl: 'iconos/punto_1.png', iconSize: [30,30], iconAnchor: [15,30] }),
    "Ecoaldea": L.icon({ iconUrl: 'iconos/punto_3.png', iconSize: [30,30], iconAnchor: [15,30] }),
    "Zonas Arqueológicas": L.icon({ iconUrl: 'iconos/punto_2.png', iconSize: [30,30], iconAnchor: [15,30] }),
    "Atrativos": L.icon({ iconUrl: 'iconos/punto_5.png', iconSize: [30,30], iconAnchor: [15,30] })
  };

  // Inicializar capas vacías por tipo
  for (let tipo in iconos) {
    capas[tipo] = L.layerGroup().addTo(map);
  }

  // Cargar puntos desde CSV
  Papa.parse("data/Listado_de_Puntos.csv", {
    download: true,
    header: true,
    complete: function(results) {
      const bounds = [];
      results.data.forEach(row => {
        if (!row.Latitud || !row.Longitud) return;
        const latlng = [parseFloat(row.Latitud), parseFloat(row.Longitud)];
        const tipo = row.Tipo || "Atrativos";
        const nombre = row.Nombre || "Sin nombre";
        const icono = iconos[tipo] || iconos["Atrativos"];
        const marker = L.marker(latlng, { icon: icono }).bindPopup(`<h3>${nombre}</h3><p>${tipo}</p>`);
        capas[tipo].addLayer(marker);
        bounds.push(latlng);
      });
      if (bounds.length) map.fitBounds(bounds);
    }
  });

  // Cargar líneas desde geojson
  fetch("data/lineas.geojson")
    .then(res => res.json())
    .then(data => {
      const colorMap = {
        "Camino a la Zona Arqueolóica de Calakmul": "#d95f02",
        "Carretera Champotón-Escárcega": "#7570b3",
        "Carretera Escárcega-Chetumal": "#1b9e77",
        "Trazo Tren Maya": "#e7298a"
      };
      L.geoJSON(data, {
        style: function(feature) {
          return {
            color: colorMap[feature.properties.Nombre] || "#333",
            weight: 4
          };
        },
        onEachFeature: function (feature, layer) {
          layer.bindPopup(feature.properties.Nombre);
        }
      }).addTo(map);
    });

  // Geolocalización
  document.querySelector(".pulse-btn").addEventListener("click", () => {
    if (!navigator.geolocation) return alert("Geolocalización no soportada.");
    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      L.circleMarker([lat, lon], {
        radius: 10,
        color: '#ff5722',
        fillColor: '#ff5722',
        fillOpacity: 0.8
      }).addTo(map).bindPopup("¡Estás aquí!").openPopup();
      map.setView([lat, lon], 15, { animate: true });
    }, () => alert("No se pudo obtener tu ubicación."));
  });
</script>
</body>
</html>
