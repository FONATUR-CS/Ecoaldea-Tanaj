
<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <title>Mapa Interactivo Ecoaldea Tanaj</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <link rel="stylesheet" href="css/estilo.css" />
</head>
<body>
<header>
  <h1>Mapa Interactivo de Ecoaldea Tanaj</h1>
</header>
<div id="map"></div>
<div id="legend" class="legend"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>

<script>
  const map = L.map('map').setView([18.51, -89.88], 13);
  const base = L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png', {
    attribution: '춸 CartoDB, OpenStreetMap contributors'
  }).addTo(map);

  // Grupos de capas
  const capas = {
    "Zonas Arqueol칩gicas": L.layerGroup().addTo(map),
    "Tren Maya": L.layerGroup().addTo(map),
    "Servicios": L.layerGroup().addTo(map),
    "Atractivos": L.layerGroup().addTo(map),
    "L칤neas": L.layerGroup().addTo(map)
  };

  // 칈conos
  const iconos = {
    "Guardia Nacional": L.icon({ iconUrl: 'iconos/punto_1.png', iconSize: [30,30], iconAnchor: [15,30] }),
    "Estacionamiento": L.icon({ iconUrl: 'iconos/punto_4.png', iconSize: [30,30], iconAnchor: [15,30] })
  };

  // Cargar CSV
  Papa.parse("data/Listado_de_Puntos.csv", {
    download: true,
    header: true,
    complete: function(results) {
      const bounds = [];
      results.data.forEach(row => {
        if (!row.Nombre || !row.Latitud || !row.Longitud) return;
        const tipo = row.Tipo || "Atractivos";
        const icono = iconos[row.Tipo] || undefined;
        const marker = L.marker([+row.Latitud, +row.Longitud], { icon: icono }).bindPopup(
          `<h3>${row.Nombre}</h3><p>${tipo}</p>
          <img src="${row.Imagen || 'https://via.placeholder.com/300x150'}" style="width:100%;border-radius:8px;">
          ${row.URL ? `<br><a href="${row.URL}" target="_blank">M치s informaci칩n</a>` : ''}`
        );
        if (capas[tipo]) capas[tipo].addLayer(marker);
        else capas["Atractivos"].addLayer(marker);
        bounds.push([+row.Latitud, +row.Longitud]);
      });
      if (bounds.length > 0) map.fitBounds(bounds);
    }
  });

  // Cargar l칤neas simuladas
  const lineas = [
    { coords: [[18.50, -89.89], [18.52, -89.87]], color: "#d95f02", label: "Camino a Zona Arqueol칩gica de Calakmul" },
    { coords: [[18.48, -89.90], [18.55, -89.85]], color: "#7570b3", label: "Carretera Champot칩n-Esc치rcega" },
    { coords: [[18.47, -89.92], [18.53, -89.84]], color: "#1b9e77", label: "Carretera Esc치rcega-Chetumal" },
    { coords: [[18.45, -89.88], [18.56, -89.88]], color: "#e7298a", label: "Tren Maya" }
  ];
  lineas.forEach(l => {
    const polyline = L.polyline(l.coords, { color: l.color, weight: 4 }).bindPopup(l.label);
    capas["L칤neas"].addLayer(polyline);
  });

  // Leyenda con checkboxes
  const leyendaHTML = `
    <h4>Capas del mapa</h4>
    ${Object.keys(capas).map(nombre => `
      <label><input type="checkbox" checked onchange="this.checked ? map.addLayer(capas['${nombre}']) : map.removeLayer(capas['${nombre}'])" /> ${nombre}</label><br>
    `).join('')}
  `;
  document.getElementById("legend").innerHTML = leyendaHTML;
</script>

  // Bot칩n 'Est치s aqu칤'
  const btn = document.createElement('button');
  btn.innerHTML = "游늸";
  btn.className = "pulse-btn";
  btn.title = "Mostrar mi ubicaci칩n";
  document.body.appendChild(btn);

  btn.addEventListener('click', () => {
    if (!navigator.geolocation) {
      alert("La geolocalizaci칩n no est치 soportada en este navegador.");
      return;
    }
    navigator.geolocation.getCurrentPosition(pos => {
      const lat = pos.coords.latitude;
      const lon = pos.coords.longitude;
      const userMarker = L.circleMarker([lat, lon], {
        radius: 10,
        color: '#ff5722',
        fillColor: '#ff5722',
        fillOpacity: 0.8
      }).addTo(map).bindPopup("춰Est치s aqu칤!").openPopup();
      map.setView([lat, lon], 15, { animate: true });
    }, () => alert("No se pudo obtener tu ubicaci칩n."));
  });
</script>

</body>
</html>
